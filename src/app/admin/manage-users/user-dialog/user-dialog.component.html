<div class="dialog-wrapper">
  <!-- Header -->
  <div class="dialog-header">
    <div class="dialog-header-left">
      <div class="dialog-icon-wrapper">
        <mat-icon>{{ isEditMode ? 'edit' : 'person_add' }}</mat-icon>
      </div>
      <div>
        <h2 class="dialog-title">{{ title }}</h2>
        <p class="dialog-subtitle">{{ isEditMode ? 'Modifica los datos del usuario' : 'Completa los datos del nuevo usuario' }}</p>
      </div>
    </div>
    <button mat-icon-button class="close-btn" (click)="onCancel()" [disabled]="isSaving">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Content -->
  <div class="dialog-body">
    <form [formGroup]="form" class="user-form">
      <!-- Personal Info Section -->
      <div class="form-section">
        <div class="form-section-label">
          <mat-icon>person</mat-icon>
          <span>Informacion personal</span>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Nombre</mat-label>
            <input matInput formControlName="nombre" placeholder="Nombre">
            <mat-error *ngIf="form.get('nombre')?.hasError('required')">El nombre es requerido</mat-error>
            <mat-error *ngIf="form.get('nombre')?.hasError('minlength')">Minimo 2 caracteres</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Apellidos</mat-label>
            <input matInput formControlName="apellidos" placeholder="Apellidos">
            <mat-error *ngIf="form.get('apellidos')?.hasError('required')">Los apellidos son requeridos</mat-error>
            <mat-error *ngIf="form.get('apellidos')?.hasError('minlength')">Minimo 2 caracteres</mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Account Section -->
      <div class="form-section">
        <div class="form-section-label">
          <mat-icon>account_circle</mat-icon>
          <span>Cuenta</span>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Usuario</mat-label>
            <input matInput formControlName="usuario" placeholder="Nombre de usuario">
            <mat-error *ngIf="form.get('usuario')?.hasError('required')">El usuario es requerido</mat-error>
            <mat-error *ngIf="form.get('usuario')?.hasError('minlength')">Minimo 3 caracteres</mat-error>
            <mat-hint *ngIf="isEditMode">El usuario no puede ser modificado</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Email</mat-label>
            <input matInput formControlName="email" placeholder="correo@ejemplo.com" type="email">
            <mat-error *ngIf="form.get('email')?.hasError('required')">El email es requerido</mat-error>
            <mat-error *ngIf="form.get('email')?.hasError('email')">Ingrese un email valido</mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Security Section -->
      <div class="form-section">
        <div class="form-section-label">
          <mat-icon>security</mat-icon>
          <span>Seguridad y rol</span>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>{{ isEditMode ? 'Nueva Contrasena (opcional)' : 'Contrasena' }}</mat-label>
            <input matInput formControlName="password" [type]="hidePassword ? 'password' : 'text'" placeholder="Contrasena">
            <button mat-icon-button matSuffix type="button" (click)="hidePassword = !hidePassword">
              <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            <mat-error *ngIf="form.get('password')?.hasError('required')">La contrasena es requerida</mat-error>
            <mat-error *ngIf="form.get('password')?.hasError('minlength')">Minimo 6 caracteres</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Rol</mat-label>
            <mat-select formControlName="rolId" placeholder="Seleccionar rol">
              <mat-option *ngFor="let rol of roles" [value]="rol.id">
                {{ rol.nombre }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="form.get('rolId')?.hasError('required')">El rol es requerido</mat-error>
          </mat-form-field>
        </div>
      </div>
    </form>
  </div>

  <!-- Actions -->
  <div class="dialog-actions">
    <button mat-stroked-button class="cancel-btn" (click)="onCancel()" [disabled]="isSaving">
      Cancelar
    </button>
    <button mat-flat-button class="save-btn" (click)="onSave()" [disabled]="isSaving || form.invalid">
      <mat-spinner *ngIf="isSaving" diameter="18"></mat-spinner>
      <mat-icon *ngIf="!isSaving">{{ isEditMode ? 'save' : 'person_add' }}</mat-icon>
      <span>{{ isSaving ? 'Guardando...' : (isEditMode ? 'Guardar Cambios' : 'Crear Usuario') }}</span>
    </button>
  </div>
</div>
