<div class="manage-container">
  <!-- Header Section -->
  <div class="manage-header">
    <div class="header-content">
      <div class="header-left">
        <div class="header-icon-wrapper">
          <mat-icon>group</mat-icon>
        </div>
        <div>
          <h1 class="page-title">Gestionar Usuarios</h1>
          <p class="page-subtitle">Administra los usuarios del sistema</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Metrics Cards -->
  <div class="metrics-section">
    <div class="metric-card">
      <div class="metric-icon-bg total-bg">
        <mat-icon>people</mat-icon>
      </div>
      <div class="metric-content">
        <span class="metric-value">{{ users.length }}</span>
        <span class="metric-label">Total</span>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon-bg active-bg">
        <mat-icon>check_circle</mat-icon>
      </div>
      <div class="metric-content">
        <span class="metric-value">{{ getActiveCount() }}</span>
        <span class="metric-label">Activos</span>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon-bg inactive-bg">
        <mat-icon>cancel</mat-icon>
      </div>
      <div class="metric-content">
        <span class="metric-value">{{ getInactiveCount() }}</span>
        <span class="metric-label">Inactivos</span>
      </div>
    </div>
  </div>

  <!-- Table Section -->
  <div class="table-section">
    <div class="section-header">
      <div class="section-title-group">
        <mat-icon class="section-icon">table_chart</mat-icon>
        <div>
          <h2 class="section-title">Lista de Usuarios</h2>
          <p class="section-subtitle">Crea, edita y gestiona los usuarios del sistema</p>
        </div>
      </div>
      <button mat-flat-button class="add-btn" (click)="openCreateDialog()">
        <mat-icon>person_add</mat-icon>
        Nuevo Usuario
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Cargando usuarios...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && users.length === 0" class="empty-state">
      <mat-icon class="empty-icon">person_off</mat-icon>
      <h3>No hay usuarios registrados</h3>
      <p>Crea un nuevo usuario para comenzar</p>
    </div>

    <!-- Desktop Table View -->
    <div class="table-container desktop-only" *ngIf="!isLoading && users.length > 0">
      <table mat-table [dataSource]="users" class="users-table">

        <!-- Nombre Column -->
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef>Usuario</th>
          <td mat-cell *matCellDef="let user">
            <div class="user-name-cell">
              <div class="user-avatar" [class.avatar-inactive]="!user.estado">{{ getInitials(user.nombreCompleto) }}</div>
              <div class="user-name-info">
                <span class="user-fullname">{{ user.nombreCompleto }}</span>
                <span class="user-username">{{'@'}}{{ user.usuario }}</span>
              </div>
            </div>
          </td>
        </ng-container>

        <!-- Email Column -->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>Email</th>
          <td mat-cell *matCellDef="let user">
            <span class="email-text">{{ user.email }}</span>
          </td>
        </ng-container>

        <!-- Rol Column -->
        <ng-container matColumnDef="rol">
          <th mat-header-cell *matHeaderCellDef>Rol</th>
          <td mat-cell *matCellDef="let user">
            <span class="role-badge">
              <mat-icon class="role-icon">badge</mat-icon>
              {{ user.rolNombre }}
            </span>
          </td>
        </ng-container>

        <!-- Estado Column -->
        <ng-container matColumnDef="estado">
          <th mat-header-cell *matHeaderCellDef>Estado</th>
          <td mat-cell *matCellDef="let user">
            <span class="status-badge" [class]="user.estado ? 'status-active' : 'status-inactive'">
              <span class="status-dot"></span>
              {{ user.estado ? 'Activo' : 'Inactivo' }}
            </span>
          </td>
        </ng-container>

        <!-- Acciones Column -->
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let user">
            <div class="actions-container">
              <button mat-icon-button matTooltip="Editar" class="edit-btn" (click)="openEditDialog(user)">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button matTooltip="Desactivar" class="deactivate-btn" (click)="deleteUser(user)" *ngIf="user.estado">
                <mat-icon>person_off</mat-icon>
              </button>
              <button mat-icon-button matTooltip="Eliminar permanentemente" class="delete-btn" (click)="eliminarUser(user)">
                <mat-icon>delete_forever</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
      </table>
    </div>

    <!-- Mobile Cards View -->
    <div class="mobile-cards-container mobile-only" *ngIf="!isLoading && users.length > 0">
      <div class="mobile-card" *ngFor="let user of users">
        <div class="mobile-card-header">
          <div class="user-info-mobile">
            <div class="user-avatar mobile-avatar" [class.avatar-inactive]="!user.estado">{{ getInitials(user.nombreCompleto) }}</div>
            <div class="user-mobile-details">
              <h3 class="mobile-fullname">{{ user.nombreCompleto }}</h3>
              <span class="mobile-username">{{'@'}}{{ user.usuario }}</span>
            </div>
          </div>
          <span class="status-badge mobile-badge" [class]="user.estado ? 'status-active' : 'status-inactive'">
            <span class="status-dot"></span>
            {{ user.estado ? 'Activo' : 'Inactivo' }}
          </span>
        </div>

        <div class="mobile-card-content">
          <div class="mobile-field">
            <mat-icon>email</mat-icon>
            <span>{{ user.email }}</span>
          </div>
          <div class="mobile-field">
            <mat-icon>badge</mat-icon>
            <span>{{ user.rolNombre }}</span>
          </div>
        </div>

        <div class="mobile-actions">
          <button mat-flat-button class="mobile-edit-btn" (click)="openEditDialog(user)">
            <mat-icon>edit</mat-icon>
            Editar
          </button>
          <button mat-stroked-button class="mobile-deactivate-btn" (click)="deleteUser(user)" *ngIf="user.estado">
            <mat-icon>person_off</mat-icon>
            Desactivar
          </button>
          <button mat-stroked-button class="mobile-delete-btn" (click)="eliminarUser(user)">
            <mat-icon>delete_forever</mat-icon>
            Eliminar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
